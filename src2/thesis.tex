\documentclass[a4paper]{book}

%\usepackage[latin9]{inputenc}
\usepackage[utf8x]{inputenc}
\usepackage[pdftex]{graphicx}
\usepackage{pdfpages}
\usepackage[british]{babel}
\usepackage{placeins}
\usepackage{dialogue}
\usepackage{fancyvrb}

\usepackage{t1enc}         
\usepackage{times}
\usepackage{url}
\usepackage{enumerate}

%\usepackage{code}
\usepackage{hyperref}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
%\usepackage{lingmacros}
\usepackage{subfig}
\usepackage{fancyhdr}


\pagestyle{plain}
%\pagenumbering{arabic}


%stuff
\usepackage{latexsym}
\usepackage{tikz,pgflibraryshapes}
\usetikzlibrary{shapes,snakes,positioning}
\usepackage{pgfplots}
\usepackage{booktabs}
%\usepackage{etoolbox}


\usepackage{multibib} 
\newcites{bb}{Bibliography} 
\newcites{ifl}{Bibliography}
\newcites{papp}{Bibliography}
\newcites{exp}{Bibliography}
\newcites{hl}{Bibliography}
\newcites{csort}{Bibliography}
\newcites{emb}{Bibliography}
\newcites{arbb}{Bibliography}
% \newcites{t}{Bibliography}
%\newcites[ifl}{Bibliography}

%\patchcmd{\thebibliography}{\section*}{\section}{}{}

\makeatletter
\renewenvironment{thebibliography}[1]
     {\section*{\bibname}%
      %\@mkboth{\MakeUppercase\bibname}{\MakeUppercase\bibname}%
      \list{\@biblabel{\@arabic\c@enumiv}}%
           {\settowidth\labelwidth{\@biblabel{#1}}%
            \leftmargin\labelwidth
            \advance\leftmargin\labelsep
            \@openbib@code
            \usecounter{enumiv}%
            \let\p@enumiv\@empty
            \renewcommand\theenumiv{\@arabic\c@enumiv}}%
      \sloppy
      \clubpenalty4000
      \@clubpenalty \clubpenalty
      \widowpenalty4000%
      \sfcode`\.\@m}
     {\def\@noitemerr
       {\@latex@warning{Empty `thebibliography' environment}}%
      \endlist}
\makeatother


%%

%% \newcommand{\bequ}{\begin{quote}}
%% \newcommand{\enqu}{\end{quote}}
%% \newcommand{\eop}[1]{\mbox{\sl #1}}
%% \newcommand{\sube}[2]{#1_{#2}}
%% \newcommand{\id}[1]{{\it #1}}
%% \newcommand{\kwd}[1]    {\mbox{\textbf{#1}}}
%% \newcommand{\str}[1]{{\id "#1"}}
%% \newcommand{\lemon}{\emph{lemon}}
%% \newcommand{\textt}[1]{\texttt{#1}}
%% \newcommand{\txttt}[1]{\texttt{#1}}

%\renewcommand*{\thesection}{\arabic{section}}

\newcommand{\thesistitle}{Embedded Languages for Data Parallel Computation}
\newcommand{\dept}{Department of Computer Science and Engineering}
\newcommand{\uni}{Chalmers University of Technology and G\"oteborg University}
\newcommand{\group}{Functional Programming Research Group}


% ---------------------------------------------------------------------------
% Papers 
% ---------------------------------------------------------------------------
\newcommand{\paperBB}{Simple and Compositional Reification of Monadic Embedded Languages}
\newcommand{\paperIFL}{Obsidian: A Domain Specific Embedded Language for Parallel Programming of Graphics Processors}
\newcommand{\paperPAPP}{GPGPU Kernel Implementation and Refinement using Obsidian} 
\newcommand{\paperEXPRESSIVE}{Expressive Array Constructs in an Embedded GPU Kernel Programming Language}
\newcommand{\paperCSORT}{Counting and Occurrence Sort for GPUs using an Embedded Language}
\newcommand{\paperHL}{A High-Level Embedded Language for Low-Level GPU Kernel Programming}
\newcommand{\paperARBB}{Programming Future Parallel Architectures with Haskell and Intel ArBB}
\newcommand{\paperEMBARBB}{Parallel Programming in Haskell Almost for Free}

% ---------------------------------------------------------------------------
% BEGIN ! 
% ---------------------------------------------------------------------------
\begin{document}

\begin{titlepage}
\begin{centering}
{\sc Thesis for the Degree of Doctor of Philosophy}
\vspace{30ex}

{\LARGE\bf\thesistitle}

\vspace{7ex}

\large Bo Joel Svensson
\vfill
\includegraphics[width=120mm]{./img/ChalmGUtextsvEng}\\[5mm]
\includegraphics[height=4cm]{./img/ChalmGUmarke}\\

\vspace{1cm}
\normalsize
{\sc \dept}\\
{\sc \uni}\\
G\"oteborg, Sweden 2013

\end{centering}
\end{titlepage}

% ---------------------------------------------------------------------------
% Tryckortssida
% ---------------------------------------------------------------------------

\quad \vfill

{\noindent\large\bf\thesistitle} \\
\noindent Bo Joel Svensson \\
\noindent ISBN \\

\vspace{1cm}

\noindent\copyright {\sc {Bo Joel Svensson}}, 2013 \\ 
\vspace{1cm} 

\noindent Technical Report 101D\\
\noindent ISSN                 \\
\noindent \dept \\
\noindent \group\\

\vspace{1cm} 

\noindent \uni \\
\noindent SE--412~96~~G\"oteborg, Sweden\\
\noindent Phone: +46 (0)31--772~1000 \\

\vspace{1cm} 

\noindent Printed in Sweden\\
\noindent Chalmers Reproservice\\
\noindent G\"oteborg, Sweden 2013


\thispagestyle{empty}

\clearpage
\pagenumbering{roman}

\section*{Abstract}
Abstract abstract 

\vspace{5mm}

\noindent

 \textbf{Keywords:} Keyword1, Keyword2  

\clearpage

% ---------------------------------------------------------------------------
%  ACKS !!! 
% ---------------------------------------------------------------------------
\section*{Acknowledgments}


\vspace{5mm}
This research has been funded by the Swedish Foundation for
Strategic Research (which funds the Resource Aware Functional 
Programming (RAW FP) Project) and by the Swedish Research Council.

\clearpage

% ---------------------------------------------------------------------------
%  Guide for Oponent, grading committee
% ---------------------------------------------------------------------------
\section*{About this thesis} 

This thesis contains an introduction and a selection of papers. The introduction 
gives background and context to the papers. 

The papers contained in this thesis falls in three categories. 
\begin{itemize} 
\item General EDSL methodology in chapter~\ref{chap:EDSLImplementation}. 
\item GPU Programming using an EDSL in chapter~\ref{chap:GPUProgramming}. 
\item Retargetable parallel programming in chapter~\ref{chap:ArBB}. 
\end{itemize} 
%In the following sections, each paper is given a short description. Hopefully 
%there is enough information to wet the apetite. 

\subsection*{EDSL implementation papers} 

\subsubsection*{\paperBB} 

Authors: Josef Svenningsson and Bo Joel Svensson 

\vspace{5mm}

\noindent We present a simple and compositional method for refication 
of monads (or compilation of a monadic embedded language). I implemented 
Obsidian using the method described here. The novelty and 
usefulness of this simple way to reify monads was recognised by Josef
and lead to the writing of this paper.  

\subsection*{GPU programming papers} 

\subsubsection{\paperIFL}

Authors: Bo Joel Svensson, Mary Sheeran and Koen Claessen \newline

\vspace{5mm}

The first real paper about Obsidian, our embedded language for GPU 
programming. In this paper we identify similarities between 
conenction patterns in hardware and parallel computations on GPUs. 
We introduce a structured and compositional way to write data-parallel 
programs on a GPU.

Basic parallel building blocks are implemented in a monadic style and 
composed using a sequential composition operator {\tt ->-}. 

\subsubsection{\paperPAPP}

Authors: Bo Joel Svensson, Koen Claessen and Mary Sheeran \newline

\vspace{5mm}

\emph{a new program representation, based vaguely on Arrows} 


\subsubsection{\paperEXPRESSIVE}

Authors: Koen Claessen, Mary Sheeran and  Bo Joel Svensson \newline

\vspace{5mm}

This paper introduces {\em Push} arrays, invented by Koen Claessen. This 
array representation target specific performance problems that we want 
to solve with Obsidian. 


\subsubsection{\paperCSORT} 

Authors: Josef Svenningsson, Bo Joel Svensson and Mary Sheeran \newline

\vspace{5mm}

\subsubsection{\paperHL}

Authors: Bo Joel Svensson and Mary Sheeran \newline
\noindent \emph{This work has not been published.}
\vspace{5mm} 

\noindent 

In this paper the most recent additions and improvements of Obsidian are 
described. 

\subsubsection{Retargetable parallel programming} 

\subsubsection{\paperARBB}

Authors: Bo Joel Svensson and Ryan R. Newton

\vspace{5mm}

\noindent This position paper describes the work I did while on a 3 month internship at 
Intel. The main part of this work was implementation of Haskell bindings 
for the now retired Intel ArBB system. 

The paper also describes work we did towards implementing a backend for the 
Accelerate system using ArBB. We reached a proof-of-concept implementation 
capable of running some simple Accelerate programs using the ArBB backend.
However, much work would remain to be able to run the full scope of Accelerate 
programs on ArBB.  

\subsubsection{\paperEMBARBB}

Authors: Bo Joel Svensson and Mary Sheeran 

\vspace{5mm}

\noindent Here we explore another way to provide the capabilities of ArBB to the 
Haskell programmer. Rather than trying to use ArBB as a backend to Accelerate 
we provide a more direct mapping of ArBB's functionality to Haskell idioms. 
Simply put, this means providing a more Haskell-programmer-friendly interface compared
to the raw ArBB bindings (which are a collection of functions in the IO monad). 

\subsection*{Guide} 




\tableofcontents


\cleardoublepage
\clearpage

\pagenumbering{arabic}
\pagestyle{fancy}
\fancyfoot{}
\fancyhead[LO]{}
\fancyhead[RO]{\leftmark}
\renewcommand{\headrulewidth}{0.0pt}
\fancyhead[LE,RO]{\thepage}

% --------------------------------------------------------------------------- %
% --------------------------------------------------------------------------- %
%
%  INTRODUCTION 
%
% --------------------------------------------------------------------------- %
% --------------------------------------------------------------------------- %
\chapter{\thesistitle}

\section{Introduction} 

This thesis is about applying embedded language techniques to programming 
multi- and many-core computers. Computers today are becoming more and more  
parallel. With each new generation of 
general purpose processor (CPU) or graphics processor (GPU) we get more 
parallel resources. To fully make use of modern CPUs and GPUs we need to fully 
exploit their parallelism. 

Modern CPUs are parallel in a number of different ways. They discover instruction
level parallelism (ILP), they have multiple processor cores and vector units for 
Single Instruction Multiple Data parallelism. The exact configuration, number
of cores and number of vector units, vary over available processor models. 
To obtain maximum performance, with a specific target processor in mind, the programmer
would use low-level intrinsics in order to get SIMD parallelism and some threading library
for parallelism over the available cores. One problem with this is that the resulting program 
would be specialised to a specific processor model. 

In chapter~\ref{chap:ArBB}, 

\noindent\emph{More text, lead into something about ArBB and forward ref to ArBB papers}

\noindent\emph{Data-Parallelism, Structured-Compositional programming} 

Graphics Processors (GPUs), trade programmer convenience for increased parallelism. 
For example, where CPUs dedicate much chip real estate for caches, branch prediction and 
ILP, GPUs put additional cores. This comes at a price of increased programmer effort.
GPUs have programmer managed shared memories, conditionals are troublesome from a performance 
perspective and memory access patterns can make or break the performance of an 
application.  

\noindent\emph{More text, lead into something about compositional, high-level, but 
expressive enough programming models for GPU programming and ref to Obsidian Chapter} 

%\noindent\emph{GPUs} 

%\subsection{Data-parallel programming on GPUs} 

%\subsection{Data-parallel programming on CPUs}

\section{The problem}

\emph{what is so interesting about Parallelism and GPUs}

\section{Embedded languages}


\section{Obsidian: An embedded language for GPU kernel implementation}

\noindent\emph{Obsidian, Embedded languages} 

\noindent\emph{Array representations} 

\noindent\emph{Compositionality} 

\noindent\emph{Hierarchies} 

\section{Embedding Intel Array Building Blocks} 

\noindent\emph{Short section about the approach taken with EmbArBB}

\section{The results} 

\emph{ How well did we do?} 

\subsection{Related work} 

\noindent\emph{GPU Programmming languages}

\noindent\emph{data-parallel programming languages} 

\noindent\emph{Embedded languages} 

\noindent\emph{Monad reification methods} 

\section{Future work} 

\noindent\emph{Find a niche for Obsidian} 

\noindent\emph{Improve on Warp level capabilities} 

\noindent\emph{Improve expressivity, code performance} 

\section{Discussion} 




\clearpage{}

% --------------------------------------------------------------------------- %
% --------------------------------------------------------------------------- %
%
%  PAPERS 
%
% --------------------------------------------------------------------------- %
% --------------------------------------------------------------------------- %


\chapter{EDSL Implementation Papers}
\label{chap:EDSLImplementation}
% ---------------------------------------------------------------------------
% 
% ---------------------------------------------------------------------------
\cleardoublepage 


\section{\paperBB}
\label{sec:paperBB}
%\addcontentsline{toc}{chapter}{Simple and Compositional Reification of Monadic Embedded Languages}

\begin{center} 
Josef Svenningsson, Bo Joel Svensson
\end{center}


\input{./bb/paperThesis}



\chapter{GPU Programming Papers}
\label{chap:GPUProgramming}

% ---------------------------------------------------------------------------
% 
% ---------------------------------------------------------------------------
\cleardoublepage 

\section{\paperIFL}
\label{sec:paperIFL}
%\addcontentsline{toc}{chapter}{Obsidian: A Domain Specific Embedded Language for
%Parallel Programming of Graphics Processors}

\begin{center} 
Bo Joel Svensson, Mary Sheeran, Koen Claessen
\end{center}

\input{./ifl/paperThesis}

% ---------------------------------------------------------------------------
% 
% ---------------------------------------------------------------------------
\cleardoublepage 

\section{\paperPAPP}
\label{sec:paperPAPP}
%\addcontentsline{toc}{chapter}{Obsidian: GPU Computing Using Haskell}

\begin{center} 
Bo Joel Svensson, Koen Claessen, Mary Sheeran
\end{center}

\input{./papp/paperThesis}


% ---------------------------------------------------------------------------
% 
% ---------------------------------------------------------------------------
\cleardoublepage 

\section{\paperEXPRESSIVE}
\label{sec:paperEXPRESSIVE}
%\addcontentsline{toc}{chapter}{Expressive Array Constructs in an Embedded GPU Kernel Programming Language}

\begin{center} 
Koen Claessen, Mary Sheeran, Bo Joel Svensson
\end{center}

\input{./expressive/paperThesis}

% ---------------------------------------------------------------------------
% 
% ---------------------------------------------------------------------------
\cleardoublepage 

\section{\paperCSORT}
\label{sec:paperCSORT}
%\addcontentsline{toc}{chapter}{Counting and Occurrence Sort for GPUs using an Embedded Language}

\begin{center} 
Josef Svenningsson, Bo Joel Svensson, Mary Sheeran 
\end{center}


\input{./csort/paperThesis}


% ---------------------------------------------------------------------------
% 
% ---------------------------------------------------------------------------
\cleardoublepage 


\section{\paperHL}
\label{sec:paperHL}
%\addcontentsline{toc}{chapter}{Simple and Compositional Reification of Monadic Embedded Languages}

\begin{center} 
Bo Joel Svensson, Mary Sheeran
\end{center}


\input{./hl/paperThesis}



% ---------------------------------------------------------------------------
% 
% ---------------------------------------------------------------------------

\chapter{Retargetable Parallel Programming Papers}
\label{chap:ArBB}
% ---------------------------------------------------------------------------
% 
% ---------------------------------------------------------------------------
\cleardoublepage 


\section{\paperARBB}
\label{sec:paperARBB}
%\addcontentsline{toc}{chapter}{Parallel Programming in Haskell Almost for Free}

\begin{center} 
Bo Joel Svensson, Ryan R. Newton
\end{center}


\input{./arbb/paperThesis}

% ---------------------------------------------------------------------------
% 
% ---------------------------------------------------------------------------
\cleardoublepage 


\section{\paperEMBARBB}
\label{sec:paperEMBARBB}
%\addcontentsline{toc}{chapter}{Parallel Programming in Haskell Almost for Free}

\begin{center} 
Bo Joel Svensson, Mary Sheeran
\end{center}


\input{./embarbb/paperThesis}


\cleardoublepage


% ---------------------------------------------------------------------------
% nocites 
% ---------------------------------------------------------------------------
\nocite{*}



\makeatletter
\renewenvironment{thebibliography}[1]
     {\chapter*{\bibname}%
      \@mkboth{\MakeUppercase\bibname}{\MakeUppercase\bibname}%
      \list{\@biblabel{\@arabic\c@enumiv}}%
           {\settowidth\labelwidth{\@biblabel{#1}}%
            \leftmargin\labelwidth
            \advance\leftmargin\labelsep
            \@openbib@code
            \usecounter{enumiv}%
            \let\p@enumiv\@empty
            \renewcommand\theenumiv{\@arabic\c@enumiv}}%
      \sloppy
      \clubpenalty4000
      \@clubpenalty \clubpenalty
      \widowpenalty4000%
      \sfcode`\.\@m}
     {\def\@noitemerr
       {\@latex@warning{Empty `thebibliography' environment}}%
       \endlist}
\makeatother

\bibliographystyle{alpha}
\bibliography{thesis}
\addcontentsline{toc}{chapter}{Bibliography}

\end{document}
