
\begin{figure}
\begin{tikzpicture} % [scale = 0.40]

% stage 1
\node [draw, fill=gray!30,anchor=west] (a0) {0};
\foreach[count=\i] \j in {1,2,3,4,5,6,7} {
  \pgfmathtruncatemacro{\n}{int(\i) - 1};
  \pgfmathtruncatemacro{\m}{int(\i)};
  \node [draw, fill=gray!30,right=21pt of a\n,anchor=west] (a\m) {\j};
}  

% stage 2

\foreach[count=\i] \j in {0,1,2,5,4,9,6,13} {
  \pgfmathtruncatemacro{\n}{int(\i) - 1};
  \node [draw, fill=gray!30,below=8pt of a\n] (b\n) {\j};
}  

%stage 3

\foreach[count=\i] \j in {0,1,3,6,4,9,15,22} {
  \pgfmathtruncatemacro{\n}{int(\i) - 1};
  \node [draw, fill=gray!30,below=8pt of b\n] (c\n) {\j};
}  


%stage 4

\foreach[count=\i] \j in {0,1,3,6,10,15,21,28} {
  \pgfmathtruncatemacro{\n}{int(\i) - 1};
  \node [draw, fill=gray!30,below=8pt of c\n] (d\n) {\j};
}  


%connections 

\path [draw] (a0.south) -- (b1.north);
\path [draw] (a1.south) -- (b1.north);

\path [draw] (a2.south) -- (b3.north);
\path [draw] (a3.south) -- (b3.north);

\path [draw] (a4.south) -- (b5.north);
\path [draw] (a5.south) -- (b5.north);

\path [draw] (a6.south) -- (b7.north);
\path [draw] (a7.south) -- (b7.north);

\path [draw] (a0.south) -- (b0.north);
\path [draw] (a2.south) -- (b2.north);
\path [draw] (a4.south) -- (b4.north);
\path [draw] (a6.south) -- (b6.north);

% -- 
\path [draw] (b1.south) -- (c2.north);
\path [draw] (b1.south) -- (c3.north);
\path [draw] (b0.south) -- (c0.north);
\path [draw] (b1.south) -- (c1.north);

\path [draw] (b2.south) -- (c2.north);
\path [draw] (b3.south) -- (c3.north);
\path [draw] (b6.south) -- (c6.north);
\path [draw] (b7.south) -- (c7.north);

\path [draw] (b5.south) -- (c6.north);
\path [draw] (b5.south) -- (c7.north);
\path [draw] (b4.south) -- (c4.north);
\path [draw] (b5.south) -- (c5.north);

% --
\path [draw] (c0.south) -- (d0.north);
\path [draw] (c1.south) -- (d1.north);
\path [draw] (c2.south) -- (d2.north);
\path [draw] (c3.south) -- (d3.north);
\path [draw] (c4.south) -- (d4.north);
\path [draw] (c5.south) -- (d5.north);
\path [draw] (c6.south) -- (d6.north);
\path [draw] (c7.south) -- (d7.north);

\path [draw] (c3.south) -- (d4.north);
\path [draw] (c3.south) -- (d5.north);
\path [draw] (c3.south) -- (d6.north);
\path [draw] (c3.south) -- (d7.north);



\end{tikzpicture} 
\caption{Sklansky parallel prefix network} 
\label{fig:Sklansky}
\end{figure}

%% ---------------------------------------------------------------------------
%% Seq Scan 
%% ---------------------------------------------------------------------------

\newcommand{\seqScan}[3] { 
 \tikzset{sstyle/.style={anchor=west,draw,shape=circle,fill,inner sep=1pt}};
 \tikzset{cstyle/.style={anchor=west,draw,shape=circle,inner sep=0pt}};
 %\tikzstyle{every node}=[anchor=west,draw,shape=circle,fill,inner sep=1pt]

 \node [sstyle](r1) at (0+ #1,#2) {};
 \node [sstyle,right=.5mm of r1] (r2) {};
 \node [sstyle,right=.5mm of r2] (r3) {};
 \node [sstyle,right=.5mm of r3] (r4) {};

 
 \path [draw] (r1) -- (r2) ;
 \path [draw] (r2) -- (r3) ;
 \path [draw] (r3) -- (r4) ;
 
 % connectors 

 %\tikzstyle{every node}=[anchor=west,draw,shape=circle,inner sep=0pt]

 \node [cstyle,above=.5mm of r1] (#3c1) {};
 \node [cstyle,above=.5mm of r2] (#3c2) {};
 \node [cstyle,above=.5mm of r3] (#3c3) {};
 \node [cstyle,above=.5mm of r4] (#3c4) {};

 \node [cstyle,below=.5mm of r1] (#3c5) {};
 \node [cstyle,below=.5mm of r2] (#3c6) {};
 \node [cstyle,below=.5mm of r3] (#3c7) {};
 \node [cstyle,below=.5mm of r4] (#3c8) {};


 % wires 

 \path [draw] (r1) -- (#3c1) ;
 \path [draw] (r2) -- (#3c2) ;
 \path [draw] (r3) -- (#3c3) ;
 \path [draw] (r4) -- (#3c4) ;
 
 \path [draw] (r1) -- (#3c5) ;
 \path [draw] (r2) -- (#3c6) ;
 \path [draw] (r3) -- (#3c7) ;
 \path [draw] (r4) -- (#3c8) ;


}

